generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Address {
  id         String      @id
  customerId String
  firstName  String
  lastName   String
  city       String
  state      String
  country    String      @default("US")
  phone      String?
  isDefault  Boolean     @default(false)
  createdAt  DateTime    @default(now())
  updatedAt  DateTime
  street     String
  street2    String?
  type       AddressType @default(BOTH)
  zip        String
  Customer   Customer    @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([customerId])
  @@index([isDefault])
}

model Customer {
  id              String    @id
  clerkUserId     String    @unique
  email           String    @unique
  firstName       String?
  lastName        String?
  lastLoginAt     DateTime?
  signupSource    String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  privateMetadata Json?
  publicMetadata  Json?
  Address         Address[]
  Order           Order[]

  @@index([clerkUserId])
  @@index([email])
}

model EmailLog {
  id              String        @id
  waitlistEntryId String
  type            EmailType
  subject         String
  status          EmailStatus   @default(PENDING)
  sentAt          DateTime?
  error           String?
  createdAt       DateTime      @default(now())
  WaitlistEntry   WaitlistEntry @relation(fields: [waitlistEntryId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([type])
  @@index([waitlistEntryId])
}

model Note {
  id              String        @id
  content         String
  waitlistEntryId String
  userId          String
  createdAt       DateTime      @default(now())
  updatedAt       DateTime
  User            User          @relation(fields: [userId], references: [id])
  WaitlistEntry   WaitlistEntry @relation(fields: [waitlistEntryId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([waitlistEntryId])
}

model Order {
  id               String        @id
  orderNumber      String        @unique
  customerId       String?
  email            String
  subtotal         Int
  shipping         Int
  tax              Int
  total            Int
  createdAt        DateTime      @default(now())
  updatedAt        DateTime
  shippedAt        DateTime?
  deliveredAt      DateTime?
  carrier          String?
  paymentStatus    PaymentStatus @default(PENDING)
  stripePaymentId  String?
  trackingNumber   String?
  status           OrderStatus   @default(PENDING)
  shippingName     String?
  shippingAddress1 String?
  shippingAddress2 String?
  shippingCity     String?
  shippingState    String?
  shippingZip      String?
  shippingCountry  String?
  shippingPhone    String?
  labelUrl         String?
  Customer         Customer?     @relation(fields: [customerId], references: [id])
  OrderItem        OrderItem[]

  @@index([customerId])
  @@index([email])
  @@index([orderNumber])
  @@index([status])
}

model OrderItem {
  id        String   @id
  orderId   String
  sku       String?
  name      String
  price     Int
  quantity  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  Order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model Order_backup_1762893219972 {
  id              String?
  orderNumber     String?
  customerId      String?
  email           String?
  subtotal        Int?
  shipping        Int?
  tax             Int?
  total           Int?
  createdAt       DateTime?
  updatedAt       DateTime?
  shippedAt       DateTime?
  deliveredAt     DateTime?
  billingAddress  Json?
  carrier         String?
  customerName    String?
  items           Json?
  paymentStatus   PaymentStatus?
  shippingAddress Json?
  stripePaymentId String?
  trackingNumber  String?
  status          OrderStatus?

  @@ignore
}

model Session {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model User {
  id        String    @id
  email     String    @unique
  name      String?
  password  String?
  role      UserRole  @default(VIEWER)
  createdAt DateTime  @default(now())
  updatedAt DateTime
  Note      Note[]
  Session   Session[]

  @@index([email])
}

model WaitlistEntry {
  id               String     @id
  email            String     @unique
  name             String?
  zipCode          String?
  interestCorn     Boolean    @default(false)
  interestButter   Boolean    @default(false)
  interestFlour    Boolean    @default(false)
  interestVariety  Boolean    @default(false)
  expectedQuantity String?
  source           String?
  medium           String?
  campaign         String?
  referrer         String?
  verified         Boolean    @default(false)
  unsubscribed     Boolean    @default(false)
  createdAt        DateTime   @default(now())
  updatedAt        DateTime
  EmailLog         EmailLog[]
  Note             Note[]

  @@index([createdAt])
  @@index([email])
  @@index([zipCode])
}

enum AddressType {
  SHIPPING
  BILLING
  BOTH
}

enum EmailStatus {
  PENDING
  SENT
  FAILED
  BOUNCED
}

enum EmailType {
  WELCOME
  UPDATE
  LAUNCH
  MARKETING
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PROCESSING
  SUCCEEDED
  FAILED
  REFUNDED
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  VIEWER
}
